单体网站  一个服务器

分布式大型网站：

1.  大型门户网站：网易，新浪； 可以使用CDN，静态化等方式优化
2.  SNS网站：校内网，开心网；交互性比较多了，NOSQL，分布式缓存，高性能的通信框架
3.  电商网站：淘宝，京东，国美，苏宁;

## 一、电商网站需求

**公司高层要求：**

1. 建立一个全品类的电子商务网站（B2C），用户可以在线购买商品，可以在线支付，也可以货到付款；
2. 用户购买时可以在线和客服沟通
3. 用户收到商品后，可以给商品打分，评价；
4. 目前有成熟的进销存系统；需要与网站对接；
5. 希望能够支持3-5年的业务发展；
6. 定期举办双11，双12，女生节等活动
7. 其他的常规电商网站功能



**需求分析**

|       网站需求       |      功能需求      | 非功能需求 |
| :------------------: | :----------------: | :--------: |
| 全品类的电子商务网站 | 分类管理，商品管理 |            |
|                      |                    |            |
|                      |                    |            |
|                      |                    |            |
|  可以在线和客服沟通  |    在线客服功能    |  即时通讯  |
|                      |                    |            |
|                      |                    |            |
|                      |                    |            |
|                      |                    |            |
|                      |                    |            |



## 二、网站初级架构

web1.0 最早的网站，纯浏览用的，单向操作：客户 —》 浏览器 —》服务器

web2.0  

web3.0 

512M  考试系统 java

一台服务器（1G）：部署程序，文件系统，msyql

**三台服务器：一台部署程序，一台部署数据库，一台部署NSF文件系统**





## 三、系统容量预估

预估步骤：

1. 注册用户数 - 日均UV量 - 每日的PV量 - 每日的并发量
2. 峰值预估：平常量的2-3倍
3. 根据并发量（并发，事务数），存储容量计算系统容量

假设未来3-5年，用户数达到1000万注册用户

每秒并发数的预估：

1. 每天的UV（IP）为200万（二八原则）

2. 每日每天点击浏览30次

3. PV量：200*30 = 6000万

4. 集中访问量: `24*0.2 = 4.8小时； 会有6000万*0.8 = 4800万`

5. 每分并发量：4.8小时*60 = 288分钟，每分钟访问4800/288 = 16.7万

6. 每秒并发量：16.7万/60 = 2780 

7. 高峰值：2780*3  = 8340次

8. 1毫秒 = 2.78次访问

   

服务器预估：

1. 按照一台web服务器，支持每秒300个并发计算。平常需要10台服务器；tomcat  150个，nginx是180个

2. 高峰期：需要30台服务器

   

容量预估70/90：

​	系统CPU一般维持在70%左右的水平，高峰值达到90%的水平。内存，IO类似，

​	硬盘，网络



## 四、估算分析

以上估算几个问题：

1.  需要部署大量的服务器，高峰值计算，可能需要部署30台web服务器。并且这三十台服务器，只有秒杀，活动的时候才会用的到，造成了大量的资源浪费
2.  所有的应用部署到一台服务器，应用之间耦合严重。需要进行垂直切分和水平切分
3.  大量应用存在冗余代码
4. 服务器SESSION同步消耗大量内存和网络带宽
5. 数据需要频繁的访问数据库，数据库访问压力巨大

 

## 五、网站架构优化

大型网站一般需要做一下架构优化（优化是架构设计时候，就需要考虑的，一般从架构/代码级别解决问题，调优主要是简单参数的调整，比如uwsgi调优；如果调优涉及大量代码改造，就不是调优了，属于重构）

1. 业务拆分

   ```
   垂直切分：
       产品子系统
       购物子系统
       支付子系统
       评论子系统
       客服子系统
       接口子系统
   根据业务系统进行等级定义：
   	核心系统：产品子系统，购物子系统，支付子系统
   	非核心系统：评论子系统，客服子系统，接口子系统
   部署方案：
   	产品子系统，评论子系统
   	购物子系统，客服子系统
   	支付子系统，接口子系统
   ```

   

2. 应用集群部署（分布式部署，集群部署，负载均衡）

3. 多级缓存  Redis  Memcache

4. 单点登录（分布式Session）

5. 数据库集群（读写分离，分库分表）

6. 服务化，微服务

7. 消息队列 celery

8. 其他技术





























